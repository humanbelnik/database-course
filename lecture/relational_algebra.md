# Реляционная алгебра

## Операторы реляционной алгебры

### Традиционные операторы

| Оператор | Обозначение | 
| --- | --- |
| Объединение | `union` |  
| Пересечение | `intersect` |
| Разность | `minus` |
| Декартово произведение | `times` | 
 
---

### Специальные реляционные операторы

| Оператор | Обозначение | 
| --- | --- |
| Ограничение | `where` |  
| Проекция |  `project` |
| Соединение | `join` |
| Деление | `divide by` | 
| Переименование | `rename` |

**Пример №1.** Проекция
Для таблицы `T`:

| id | name | city |
| --- | --- | --- |
| 1 | nick | moscow |
| 2 | sam | new york |
| 3 | tay | moscow |
| 4 | ley | moscow |

Проекция `T[city]`:

| city |
| --- | 
| moscow | 
| new york | 

---

**Пример №2.** Деление

Для таблицы `T`:

| id_supplier | id_product |
| --- | --- |
| 1 | 1 |
| 1 | 2 |
| 1 | 3 | 
| 2 | 1 | 
| 2 | 2 | 
| 3 | 1 | 

Проекция `T[id_product]`:
| id_product |
| --- |
| 1 | 
| 2 |
| 3 | 

Результат деления `T divide by T[id_product]` есть поставщики, которые поставляют все детали:

| id_supplier |
| --- |
| 1 | 

---

### Зависимые операторы

> Некорые операторы РА выразимы через другие

Соединение по атрибуту `Y`:
```
A join B = ((A times (B rename Y as Y_1)) where Y = Y_1)[X, Y, Z]
```

Пересечение:
```
A intersect B = A minus (A minus B)
```

Деление:
```
A divide by B = A[X] minus ((A[X] times B) minus A)[X]
```

**Пример №3.** Различные запросы РА


| Sno | Sname | Status | City |
| --- | --- | --- | --- | 


| Pno | Pname | Color | Weight | City |
| --- | --- | --- | --- | --- |



| Sno | Pno | Qty |
| --- | --- | --- |

Запросы:

1. Получить имена поставщиков, поставляющих вторую деталь
    ```
    (
        (S join SP) where Pno = 2
    )[Sname]
    ```
2. Получить имена поставщиков, поставляющих хоть одну красную деталь
    ```
    (
        ((P where Color='Red')[Pno] join SP) join S
    )[Sname]
    ```

3. Получить имена поставщиков, которые поставлют все детали
    ```
    (
        (SP[Sno, Pno] divide by P[Pno]) join S
    )[Sname]
    ```

---

### Дополнительные операторы РА

> **Расширение `extend`** - получение отношения с новым атрибутом, полученным путем скалярного вычисления

**Пример №4.** Расширение

Несколько запросов для таблицы *Пример №3*:
| Запрос | Синтаксис |
| --- | --- |
Добавить новый атрибут | `extend P add (Weigth * 454) as gmwt` |
Добавить копию атрибута `city` и вывести новую таблицу, но без столбца `city` | `(extend S add City as SCity){all but City}` |

---

> **Обобщение `summarize`** - вертикальный аналог расширения

**Пример №5.** Обобщение

Для каждого поставщика определнить, сколько единиц товара он предоставляет

```
summarize SP per PS {Pno} add sum(Qty) as totqty
```